server {
    # O Nginx escutará na porta 80 dentro do container.
    listen 80;
    server_name localhost;

    # Define o diretório raiz onde seus arquivos estáticos estão localizados.
    root /usr/share/nginx/html;
    index index.html;

    # Bloco principal para servir os arquivos do seu site.
    location / {
        # Tenta encontrar o arquivo exato solicitado. Se não encontrar, tenta um diretório.
        # Se ambos falharem, redireciona para /index.html.
        # Isso é ESSENCIAL para que Single Page Applications (React, Vue, Angular) funcionem corretamente.
        try_files $uri $uri/ /index.html;
    }

    # Bloco de proxy reverso para a API.
    # Todas as requisições que começam com /api/ serão encaminhadas para o seu backend.
    location /api/ {
        # Usa o resolvedor de DNS interno do Docker para encontrar o serviço 'backend'.
        # Isso evita o erro "host not found" na inicialização do Nginx.
        resolver 127.0.0.11 valid=30s;

        # Define o endereço do backend em uma variável para resolução em tempo de execução.
        # A porta 8787 corresponde à porta que seu backend escuta DENTRO da rede do Docker.
        set $backend_service http://backend:8787;

        # Encaminha a requisição para o backend.
        proxy_pass $backend_service;

        # Cabeçalhos importantes para passar informações da requisição original para o backend.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_redirect off;
    }
}