<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Usuário - Só Joga</title>
    <link rel="stylesheet" href="static/css/style.css">
    <link rel="icon" type="image/png" href="img/So Joga.png">
</head>
<body>
    <header class="navbar">
        <div class="logo">
            <img src="img/So Joga.png" alt="Só Joga">
        </div>
        <nav class="menu">
            <ul>
                <li><a href="/">Página Inicial</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="cadastro-form-container">
            <h2>Crie sua Conta</h2>
            <form id="cadastroForm">
                <div class="form-group">
                    <label for="nome">Nome Completo:</label>
                    <input type="text" id="nome" name="nome" required>
                </div>
                <div class="form-group">
                    <label for="email">E-mail:</label>
                    <input type="text" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="username">Nome de Usuário (para login):</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="form-group">
                    <label for="endereco">Endereço:</label>
                    <input type="text" id="endereco" name="endereco">
                </div>
                <div class="form-group">
                    <label for="celular">Celular:</label>
                    <input type="tel" id="celular" name="celular">
                </div>
                <div class="form-group">
                    <label for="insta">Instagram (ex: @seu_usuario):</label>
                    <input type="text" id="insta" name="insta">
                </div>
                <div class="form-group">
                    <label>Esportes que pratica:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="esportes" value="Futebol"> Futebol</label>
                        <label><input type="checkbox" name="esportes" value="Volei"> Vôlei</label>
                        <label><input type="checkbox" name="esportes" value="Basquete"> Basquete</label>
                        <label><input type="checkbox" name="esportes" value="Tenis"> Tênis</label>
                    </div>
                </div>
                <div class="form-group" id="team-name-group" style="display: none;">
                    <label for="time">Nome do Time:</label>
                    <input type="text" id="time" name="time">
                </div>
                <div class="form-group">
                    <label for="posicao">Posição/Função principal:</label>
                    <input type="text" id="posicao" name="posicao">
                </div>
                <div class="form-group">
                    <div class="checkbox-group single-checkbox">
                        <input type="checkbox" id="capitao" name="capitao">
                        <label for="capitao">É capitão de time?</label>
                    </div>
                </div>
                <button type="submit">Cadastrar</button>
            </form>
            <div id="message"></div>
        </section>
    </main>

    <script>
    document.getElementById('cadastroForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);
        const messageDiv = document.getElementById('message');

        // Coleta os valores dos checkboxes de esportes
        const esportes = [];
        formData.getAll('esportes').forEach(esporte => esportes.push(esporte));

        // Mapeia os dados do formulário para o formato esperado pela API (User.java)
        const userData = {
            nome: formData.get('nome'),
            email: formData.get('email'),
            username: formData.get('username'),
            password: formData.get('password'),
            endereco: formData.get('endereco'),
            celular: formData.get('celular'),
            insta: formData.get('insta'),
            posicao: formData.get('posicao'),
            time: formData.get('time'), // Corrigido de 'teamName' para 'time' para corresponder ao formulário
            // O valor de um checkbox, se marcado, é 'on'. Convertemos para booleano.
            capitao: formData.get('capitao') === 'on',
            esportes: esportes
        };

        // O caminho da API agora é relativo para que o Nginx possa redirecionar a chamada.
        const backendUrl = '/api/users';

        try {
            const response = await fetch(backendUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });

            const result = await response.json();

            if (response.status === 201) { // 201 Created
                messageDiv.className = 'success';
                messageDiv.textContent = `Usuário '${result.username}' cadastrado com sucesso! Você já pode fazer o login na página inicial.`;
                form.reset();
            } else {
                messageDiv.className = 'error';
                messageDiv.textContent = `Erro ao cadastrar: ${result.message || 'Verifique os dados e tente novamente.'}`;
            }
        } catch (error) {
            messageDiv.className = 'error';
            messageDiv.textContent = 'Erro de conexão com o servidor.';
            console.error('Erro:', error);
        }
    });

    // --- Lógica para exibir/ocultar o campo "Nome do Time" ---
    const sportCheckboxes = document.querySelectorAll('input[name="esportes"]');
    const teamNameGroup = document.getElementById('team-name-group');
    const teamNameInput = document.getElementById('time'); // Corrigido de 'teamName' para 'time'

    function toggleTeamNameField() {
        // Verifica se algum esporte que não seja 'Tenis' está marcado
        const showTeamName = Array.from(sportCheckboxes).some(
            checkbox => checkbox.checked && checkbox.value !== 'Tenis'
        );

        if (showTeamName) {
            teamNameGroup.style.display = 'block';
        } else {
            teamNameGroup.style.display = 'none';
            teamNameInput.value = ''; // Limpa o campo se ele for ocultado
        }
    }

    // Adiciona o listener para cada checkbox de esporte
    sportCheckboxes.forEach(checkbox => checkbox.addEventListener('change', toggleTeamNameField));
    </script>
</body>
</html>